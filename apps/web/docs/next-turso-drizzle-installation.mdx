---
title: Webã‚¢ãƒ—ãƒªã®ç’°å¢ƒæ§‹ç¯‰
description: Next.js, Turso, Drizzle ã‚’ä½¿ã£ãŸç’°å¢ƒæ§‹ç¯‰
createdAt: 2025-10-23
---

[https://www.youtube.com/watch?v=mU7kn7lxKEQ&feature=youtu.be](https://www.youtube.com/watch?v=mU7kn7lxKEQ&feature=youtu.be)

[https://github.com/nino-plus/turso-setup](https://github.com/nino-plus/turso-setup)

turborepo ãƒãƒ¼ã‚¸ãƒ§ãƒ³

[https://github.com/nino-plus/turso-turborepo](https://github.com/nino-plus/turso-turborepo)



## æ¦‚è¦

[Turso](https://turso.tech/) ã¯ ç„¡æ–™ã§100ã®DBã‚’ä½œæˆã§ãã‚‹ãªã©ã€Supabaseã«æ¯”ã¹åœ§å€’çš„ãªã‚³ã‚¹ãƒˆãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹ã¨ãªã£ã¦ã„ã¾ã™ã€‚ã„ãã¤ã‚‚ã®å€‹äººã‚¢ãƒ—ãƒªã‚’ãƒªãƒªãƒ¼ã‚¹ã—ãŸã„äººã‚„ã€å­¦ç¿’ä¸­ã§è¤‡æ•°ãƒ—ãƒ­ãƒ€ã‚¯ãƒˆã‚’æ°—è»½ã«ä½œã‚ŠãŸã„äººã«ãŠã™ã™ã‚ã§ã™ã€‚

## ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆ

ã‚³ãƒãƒ³ãƒ‰ä¸€ç™ºã§ç’°å¢ƒæ§‹ç¯‰ã‚’çµ‚ãˆãŸã„äººã¯ä»¥ä¸‹ã®ãƒ†ãƒ³ãƒ—ãƒ¬ãƒ¼ãƒˆã‚’ä½¿ç”¨ã—ã¦ãã ã•ã„ã€‚

https://github.com/nino-plus/turborepo-template

## Next.js & shadcn/ui ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

Turborepo, Next.js, shadcn/ui ã‚’ä½¿ã£ãŸ monorepo ç’°å¢ƒã‚’ä½œæˆã—ã¾ã™ã€‚

```bash
pnpx shadcn@latest init -t next-monorepo -y
```

## Turso ã‚³ãƒãƒ³ãƒ‰ã®ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

ã©ã“ã§ã‚‚è‰¯ã„ã®ã§ã‚¿ãƒ¼ãƒŸãƒŠãƒ«ã§ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚ã‚³ãƒãƒ³ãƒ‰ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«å¾Œã¯éƒ½åº¦ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«ã™ã‚‹å¿…è¦ã¯ã‚ã‚Šã¾ã›ã‚“ã€‚

```bash
brew install tursodatabase/tap/turso
```

## ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç’°å¢ƒã« Drizzle ã‚’ã‚¤ãƒ³ã‚¹ãƒˆãƒ¼ãƒ«

```bash
pnpm add drizzle-orm dotenv @libsql/client
pnpm add -D drizzle-kit
```

## ãƒ­ãƒ¼ã‚«ãƒ«ã®DBã¨æ¥ç¶šã™ã‚‹

ãƒªãƒ¢ãƒ¼ãƒˆã®DBæ ã‚’æ¶ˆè²»ã—ãªã„ãŸã‚ã«ã€é–‹ç™ºæ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«DBã¨æ¥ç¶šã™ã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

`db/local/local.db` ã®ç©ºãƒ•ã‚¡ã‚¤ãƒ«ã‚’ä½œæˆã—ãŸä¸Šã§ä»¥ä¸‹ã‚’å®Ÿè¡Œ

ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆç’°å¢ƒã§å®Ÿè¡Œã—ã€ãƒ­ãƒ¼ã‚«ãƒ«DBã‚’èµ·å‹•

```bash
turso dev -f db/local/local.db
```

```bash title=.env
TURSO_DATABASE_URL=http://127.0.0.1:8080
```

gitignore ã«ä»¥ä¸‹ã‚’è¿½åŠ 

```bash
/db/local/
```

## ãƒªãƒ¢ãƒ¼ãƒˆDBã®ä½œæˆ

Tursoãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã‹ã‚‰ä½œæˆå¯èƒ½ã§ã™ãŒã€ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ä½œæˆã™ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

```bash
# ãƒªãƒ¢ãƒ¼ãƒˆã‚¢ã‚«ã‚¦ãƒ³ãƒˆã«æ¥ç¶š
turso auth login

# ãƒªãƒ¢ãƒ¼ãƒˆDBã‚’ä½œæˆ
turso db create my-app
```

DBã¸ã®æ¥ç¶šæƒ…å ±ã¯ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ç¢ºèªã§ãã¾ã™ã€‚

```bash
# DB ã®URLã‚’è¡¨ç¤º
turso db show my-app

# DB ã®èªè¨¼ã‚³ãƒ¼ãƒ‰ã‚’ç”Ÿæˆ
turso db tokens create my-app
```

```bash title=.env
TURSO_DATABASE_URL=
TURSO_AUTH_TOKEN=
```

é€šå¸¸ã¯ä¸Šè¨˜ã®ã‚­ãƒ¼ã‚’ Vercel æœ¬ç•ªç’°å¢ƒã«ã‚»ãƒƒãƒˆã™ã‚Œã°OKã§ã™ã€‚ã¾ãŸã€Previewç’°å¢ƒç”¨ã®ãƒ–ãƒ©ãƒ³ãƒã‚’ä½œæˆã—ã€Vercelãƒ—ãƒ¬ãƒ“ãƒ¥ãƒ¼ç’°å¢ƒã®ç’°å¢ƒå¤‰æ•°ã«ã‚»ãƒƒãƒˆã™ã‚‹ã“ã¨ã§æœ¬ç•ªã¨ç¢ºèªç’°å¢ƒã®DBã‚’åˆ‡ã‚Šåˆ†ã‘ã‚‹ã“ã¨ã‚‚ã§ãã¾ã™ã€‚

## Drizzle ã¨ã®æ¥ç¶š

```tsx title=db/index.ts
import { drizzle } from "drizzle-orm/libsql/web";
// ã¾ã å­˜åœ¨ã—ãªã„å ´åˆã‚³ãƒ¡ãƒ³ãƒˆã‚¢ã‚¦ãƒˆ
import * as authSchema from "./schemas/auth";

export const db = drizzle({
  connection: {
    url: process.env.TURSO_DATABASE_URL!,
    authToken: process.env.TURSO_AUTH_TOKEN!,
  },
  schema: {
    ...authSchema,
  },
});
```

```tsx title=drizzle.config.ts
import "dotenv/config";
import { defineConfig } from "drizzle-kit";

export default defineConfig({
  out: "./db/migrations",
  schema: "./db/schemas/*.ts",
  dialect: "turso",
  dbCredentials: {
    url: process.env.TURSO_DATABASE_URL!,
    authToken: process.env.TURSO_AUTH_TOKEN! || "local",
  },
});
```

## Better Auth ã¨ã®é€£æº

é€šå¸¸é€šã‚Š Drizzle ã¨é€£æºã—ã¦ãã ã•ã„ã€‚ãã®éš›ã€ `provider` ã‚’ `sqlite` ã«å¤‰æ›´ã—ã¦ãã ã•ã„ã€‚

```tsx
import { betterAuth } from "better-auth";
import { drizzleAdapter } from "better-auth/adapters/drizzle";
import { db } from "@/db";
import { nanoid } from "nanoid";
import { nextCookies } from "better-auth/next-js";
import { getBaseURL } from "./get-base-url";

export const auth = betterAuth({
  baseURL: getBaseURL(),
  database: drizzleAdapter(db, {
    provider: "sqlite", // ã“ã“ã‚’å¤‰æ›´
    usePlural: true,
  }),
  advanced: {
    database: {
      generateId: () => nanoid(10),
    },
  },
  plugins: [nextCookies()],
});
```

## ã‚¹ã‚­ãƒ¼ãƒã®æ›¸ãæ–¹Tips

SQLite ã¯ Postgres ã¨è‹¥å¹²ç•°ãªã‚Šã¾ã™ã€‚æ—¥ä»˜ã‚«ãƒ©ãƒ ã¯Better Auth ã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ã‚¹ã‚­ãƒ¼ãƒã«æº–æ‹ ã—ã€ä»¥ä¸‹ã®è¨˜è¿°ã‚’æ¨å¥¨ã—ã¾ã™ã€‚ä»¥ä¸‹ã®ã‚ˆã†ã«å…±é€šé–¢æ•°ã«ã—ã€ä»¥å¾Œç‹¬è‡ªã«å®šç¾©ã™ã‚‹ã‚¹ã‚­ãƒ¼ãƒã®æ—¥ä»˜ã‚«ãƒ©ãƒ ã«ã‚»ãƒƒãƒˆã—ã¦ãã ã•ã„ã€‚

```tsx
import { sql } from "drizzle-orm";
import { integer } from "drizzle-orm/sqlite-core";

export const timestamps = {
  createdAt: integer("created_at", { mode: "timestamp_ms" })
    .default(sql`(cast(unixepoch('subsecond') * 1000 as integer))`)
    .notNull(),
  updatedAt: integer("updated_at", { mode: "timestamp_ms" })
    .default(sql`(cast(unixepoch('subsecond') * 1000 as integer))`)
    .$onUpdate(() => /* @__PURE__ */ new Date())
    .notNull(),
};

// ä½¿ç”¨ä¾‹
export const users = sqliteTable("pets", {
  id: text("id").primaryKey(),
  name: text("name").notNull(),
  ...timestamps
});

// ã¤ã„ã§ã« id ã‚«ãƒ©ãƒ ã‚‚æ±ç”¨åŒ–ã—ã¦ãŠãã¨ä¾¿åˆ©ã§ã™
export const id = text("id")
  .primaryKey()
  .$defaultFn(() => nanoid(10));
```

Better Auth ã§è‡ªå‹•ç”Ÿæˆã•ã‚Œã‚‹ã‚¹ã‚­ãƒ¼ãƒã«ã¤ã„ã¦ã‚‚ã€ã‚¿ã‚¤ãƒ ã‚¹ã‚¿ãƒ³ãƒ—ç®‡æ‰€ã¯ä¸Šè¨˜ã®ãƒ˜ãƒ«ãƒ‘ãƒ¼ã«å·®ã—æ›¿ãˆã‚‹ã“ã¨ã‚’æ¨å¥¨ã—ã¾ã™ã€‚

better-auth ã§ç”Ÿæˆã™ã‚‹ Drizzle ã‚¹ã‚­ãƒ¼ãƒã«éæ¨å¥¨ã®è¨˜è¿°ãŒå…¥ã‚‹ä»¶ã¯Issueèµ·ç¥¨ä¸­
[https://github.com/better-auth/better-auth/issues/4796](https://github.com/better-auth/better-auth/issues/4796)

æœ€å¾Œã« Better Auth ã®Drizzleã‚¹ã‚­ãƒ¼ãƒã‚’ç”Ÿæˆã—ã¦ãã ã•ã„ã€‚

```bash
pnpx @better-auth/cli@latest generate --output ./db/schemas/auth.ts --yes
```

## ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

postgre(Supabaseãªã©)ã‹ã‚‰ç§»è¡Œã™ã‚‹éš›ã¯ã€æ—¢å­˜ã® `migrations` é–¢é€£ã®ãƒ•ã‚¡ã‚¤ãƒ«ã€ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªã‚’å‰Šé™¤ã—ã¦ãã ã•ã„ã€‚ãã®ä¸Šã§ã€ä»¥ä¸‹ã‚’å®Ÿè¡Œã—ã¾ã™ã€‚

```bash
pnpm drizzle-kit generate
pnpm drizzle-kit migrate
```

## GitHub Actions ã‚’ä½¿ã£ã¦æœ¬ç•ªç’°å¢ƒã«è‡ªå‹•ãƒã‚¤ã‚°ãƒ¬ãƒ¼ã‚·ãƒ§ãƒ³

```bash title=.github/workflows/migrate.yml
name: Apply schema migrations

# ğŸ‘‰ Only run this workflow when a change is made to the main branch
on:
  push:
    branches:
      - main

jobs:
  apply_migrations:
    runs-on: ubuntu-latest
    steps:
      - name: Checkout
        uses: actions/checkout@v3
      - name: Install dependencies & tooling
        run: |
          npm install -g pnpm
          pnpm install
      - name: Apply migrations
        run: pnpm drizzle:migrate
        env:
          TURSO_DATABASE_URL: ${{ secrets.TURSO_DATABASE_URL }}
          TURSO_AUTH_TOKEN: ${{ secrets.TURSO_AUTH_TOKEN }}

```

## ãƒ‡ãƒ¼ã‚¿ãƒ™ãƒ¼ã‚¹ã®ç¢ºèª

drizzle ã®ã‚¹ã‚¿ã‚¸ã‚ªæ©Ÿèƒ½ã§ãƒ­ãƒ¼ã‚«ãƒ«DBã®å†…å®¹ã‚’ç¢ºèªã§ãã¾ã™ã€‚

```bash
pnpm drizzle-kit studio
```

## Supabase ã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ç§»æ¤ã™ã‚‹æ–¹æ³•

ä»¥ä¸‹ã®ã‚³ãƒãƒ³ãƒ‰ã§ `data.sql` ã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’åãå‡ºã—ã¾ã™ã€‚äº‹å‰ã«Dockerã‚’èµ·å‹•ã—ã¦ãŠãå¿…è¦ãŒã‚ã‚Šã¾ã™ã€‚

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«Supabaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ç§»æ¤ã™ã‚‹å ´åˆ
pnpx supabase db dump --db-url <DB_URL> -f supabase-to-turso.sql â€“inserts â€“column-inserts --data-only

# ãƒªãƒ¢ãƒ¼ãƒˆSupabaseã‹ã‚‰ãƒ‡ãƒ¼ã‚¿ã‚’ç§»æ¤ã™ã‚‹å ´åˆ
pnpx supabase login
pnpx supabase link
pnpx supabase db dump -f supabase-to-turso.sql â€“inserts â€“column-inserts --data-only
```

`supabase-to-turso.sql` ã‚’ä»¥ä¸‹ã®ã‚ˆã†ã«ç·¨é›†ã—ã¾ã™ã€‚

- `INSERT...` ã‹ã‚‰å§‹ã¾ã‚Šã€`"public".` ã®ã‚¹ã‚­ãƒ¼ãƒã«é–¢é€£ã™ã‚‹è¡Œã®ã¿ã‚’æ®‹ã—ã¦ä»–ã‚’å‰Šé™¤
    - `drizzle.` ã‚„ `auth.` ã€ `storage.` ã‹ã‚‰ã¯ã˜ã¾ã‚‹ã‚¹ã‚­ãƒ¼ãƒãŒæ®‹ã£ã¦ãªã„ã“ã¨ã‚’ç¢ºèªã—ã¦ãã ã•ã„
- ãƒ†ãƒ¼ãƒ–ãƒ«åã® `"public".` ã®éƒ¨åˆ†ã‚’ã™ã¹ã¦å‰Šé™¤
- æ—¥ä»˜ã®ç®‡æ‰€ã‚’å¤‰æ›´ã™ã‚‹SQLæ–‡ã‚’è¿½è¨˜ã€‚SQLiteã¯ Postgres ã¨ä¸€éƒ¨ã‚«ãƒ©ãƒ ã®äº’æ›æ€§ãŒãªã„ã®ã§ã€å€¤ã®æ•´åˆæ€§ã‚’æŒãŸã›ã‚‹ãŸã‚ã«ãƒ¬ã‚³ãƒ¼ãƒ‰ã‚’æ›´æ–°ã—ã¾ã™ã€‚
    - æ—¥ä»˜æ›´æ–°SQL
        
        Better Authé–¢ä¿‚ã®ãƒ†ãƒ¼ãƒ–ãƒ«ä»¥å¤–ã«ç‹¬è‡ªãƒ†ãƒ¼ãƒ–ãƒ«ã‚‚ã‚ã‚‹å ´åˆã€æœ€ä¸‹éƒ¨ã®ã‚³ãƒ¡ãƒ³ãƒˆã‚„AIã‚’å‚è€ƒã«ã€é©å®œåŠ ç­†ã—ã¦ãã ã•ã„ã€‚
        
        ```sql
        -- ã‚¢ã‚«ã‚¦ãƒ³ãƒˆ
        
        UPDATE accounts
        SET created_at = CAST(strftime('%s', created_at) AS INTEGER)
        WHERE typeof(created_at) = 'text';
        
        UPDATE accounts
        SET updated_at = CAST(strftime('%s', updated_at) AS INTEGER)
        WHERE typeof(updated_at) = 'text';
        
        UPDATE accounts
        SET access_token_expires_at = CAST(strftime('%s', access_token_expires_at) AS INTEGER)
        WHERE typeof(access_token_expires_at) = 'text';
        
        UPDATE accounts
        SET refresh_token_expires_at = CAST(strftime('%s', refresh_token_expires_at) AS INTEGER)
        WHERE typeof(refresh_token_expires_at) = 'text';
        
        -- ã‚»ãƒƒã‚·ãƒ§ãƒ³
        
        UPDATE sessions
        SET created_at = CAST(strftime('%s', created_at) AS INTEGER)
        WHERE typeof(created_at) = 'text';
        
        UPDATE sessions
        SET updated_at = CAST(strftime('%s', updated_at) AS INTEGER)
        WHERE typeof(updated_at) = 'text';
        
        UPDATE sessions
        SET expires_at = CAST(strftime('%s', expires_at) AS INTEGER)
        WHERE typeof(expires_at) = 'text';
        
        -- ãƒ¦ãƒ¼ã‚¶ãƒ¼
        
        UPDATE users
        SET created_at = CAST(strftime('%s', created_at) AS INTEGER)
        WHERE typeof(created_at) = 'text';
        
        UPDATE users
        SET updated_at = CAST(strftime('%s', updated_at) AS INTEGER)
        WHERE typeof(updated_at) = 'text';
        
        -- verifications
        
        UPDATE verifications
        SET created_at = CAST(strftime('%s', created_at) AS INTEGER)
        WHERE typeof(created_at) = 'text';
        
        UPDATE verifications
        SET updated_at = CAST(strftime('%s', updated_at) AS INTEGER)
        WHERE typeof(updated_at) = 'text';
        
        UPDATE verifications
        SET expires_at = CAST(strftime('%s', expires_at) AS INTEGER)
        WHERE typeof(expires_at) = 'text';
        
        -- ã‚µãƒ–ã‚¹ã‚¯ãƒªãƒ—ã‚·ãƒ§ãƒ³
        
        -- UPDATE subscriptions
        -- SET period_start = CAST(strftime('%s', period_start) AS INTEGER)
        -- WHERE typeof(period_start) = 'text';
        
        -- UPDATE subscriptions
        -- SET period_end = CAST(strftime('%s', period_end) AS INTEGER)
        -- WHERE typeof(period_end) = 'text';
        
        -- UPDATE subscriptions
        -- SET trial_start = CAST(strftime('%s', trial_start) AS INTEGER)
        -- WHERE typeof(trial_start) = 'text';
        
        -- UPDATE subscriptions
        -- SET trial_end = CAST(strftime('%s', trial_end) AS INTEGER)
        -- WHERE typeof(trial_end) = 'text';
        
        -- ãã®ä»–ç‹¬è‡ªã®ãƒ†ãƒ¼ãƒ–ãƒ«ã®æ—¥ä»˜ã‚«ãƒ©ãƒ ã‚’æ›´æ–°ã™ã‚‹
        
        -- UPDATE demo_items
        -- SET created_at = CAST(strftime('%s', created_at) AS INTEGER)
        -- WHERE typeof(created_at) = 'text';
        ```
        

æœ€å¾Œã«ã€ turso ã®ã‚³ãƒãƒ³ãƒ‰ã§ãƒ‡ãƒ¼ã‚¿ã‚’ã‚¤ãƒ³ãƒãƒ¼ãƒˆã—ã¾ã™ã€‚

```bash
# ãƒ­ãƒ¼ã‚«ãƒ«ã®ä¾‹
turso db shell http://127.0.0.1:8080 < supabase-to-turso.sql
```

ãƒªãƒ¢ãƒ¼ãƒˆã®å ´åˆã¯ãƒ€ãƒƒã‚·ãƒ¥ãƒœãƒ¼ãƒ‰ã®SQLã‚³ãƒ³ã‚½ãƒ¼ãƒ«ã« `supabase-to-turso.sql` ã®å†…å®¹ã‚’è²¼ã‚Šä»˜ã‘ã¦å®Ÿè¡Œã—ã¦ãã ã•ã„ã€‚

ã—ã°ã‚‰ãã¯Supabaseç’°å¢ƒã¨ä¸¦è¡Œé‹ç”¨ï¼ˆSupabaseã¨Tursoä¸¡æ–¹ã«ãƒ‡ãƒ¼ã‚¿ã‚’ã‚»ãƒƒãƒˆã™ã‚‹ãªã©ï¼‰ã—ã€ç¢ºå®Ÿãªç§»è¡ŒãŒç¢ºèªã§ãã¦ã‹ã‚‰æ—§ç’°å¢ƒã‚’å‰Šé™¤ã™ã‚‹ã“ã¨ã‚’ãŠå‹§ã‚ã—ã¾ã™ã€‚