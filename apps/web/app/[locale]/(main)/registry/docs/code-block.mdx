import { RegistryInstallCommand } from "../components/registry-install-command";

# Code Block

シンタックスハイライトとタブ切り替え機能を備えた高機能なコードブロックコンポーネントです。

## 特徴

- 🎨 **シンタックスハイライト** - コードを美しく表示
- 📑 **タブ切り替え** - 複数のファイルを簡単に切り替え
- 📋 **コピー機能** - ワンクリックでコードをコピー
- 🏷️ **言語別アイコン** - TypeScript、JavaScript、CSS、HTMLなどのアイコンを自動表示
- 🎯 **グループ機能** - パッケージマネージャーなどの選択を保持
- 💾 **永続化** - グループ選択をローカルストレージに保存

## 基本的な使い方

単一のコードブロックを表示する場合は、通常のMarkdown記法を使用します。

```tsx
export default function Example() {
  return <div>Hello World</div>;
}
```

## 複数ファイルの表示

`:::code-group` 構文を使用することで、複数のファイルをタブで切り替えられます。

:::code-group

```tsx title="app.tsx"
import { Button } from "@/components/button";

export default function App() {
  return <Button>Click me</Button>;
}
```

```tsx title="button.tsx"
export function Button({ children }: { children: React.ReactNode }) {
  return <button className="btn">{children}</button>;
}
```

```css title="styles.css"
.btn {
  padding: 0.5rem 1rem;
  border-radius: 0.375rem;
}
```

:::

## グループ機能

`group` 属性を使用することで、パッケージマネージャーなどの選択肢を提供できます。
ユーザーの選択はローカルストレージに保存され、ページ全体で共有されます。

:::code-group

```sh group=pnpm title="pnpm"
pnpm add @workspace/ui
```

```sh group=npm title="npm"
npm install @workspace/ui
```

```sh group=yarn title="yarn"
yarn add @workspace/ui
```

:::

## プロパティ

### CodeBlock

メインのコンポーネントです。

| プロパティ | 型 | 説明 |
|---------|-----|------|
| `codes` | `CodeBlockProps[]` | 表示するコードブロックの配列 |
| `groups` | `string[]` | グループ名の配列（オプション） |

### CodeBlockProps

各コードブロックのプロパティです。

| プロパティ | 型 | 説明 |
|---------|-----|------|
| `lang` | `string` | プログラミング言語（例：`tsx`, `js`, `css`） |
| `code` | `string` | 生のコード文字列 |
| `html` | `string` | シンタックスハイライト済みのHTML |
| `title` | `string` | タブに表示するタイトル |
| `group` | `string` | グループ名（オプション） |

## サポートされている言語

以下の言語には専用のアイコンが表示されます：

- TypeScript (`.ts`, `.tsx`)
- JavaScript (`.js`, `.jsx`)
- CSS (`.css`)
- HTML (`.html`)
- YAML (`.yml`)
- Shell (`.sh`)

## コンテキストプロバイダー

### CodeGroupProvider

アプリケーションのルートレベルで使用し、グループ選択の状態を管理します。

```tsx
import { CodeGroupProvider } from "@/components/code-block";

export default function Layout({ children }) {
  return (
    <CodeGroupProvider>
      {children}
    </CodeGroupProvider>
  );
}
```

## フック

### useCode

現在のコードブロックの状態にアクセスします。

```tsx
const { currentId, setCurrentId, codes, groups, currentGroup } = useCode();
```

### useCodeGroup

グループ選択の状態にアクセスします。

```tsx
const { activeGroups, setActiveGroups } = useCodeGroup();
```

## カスタマイズ例

### 手動でコンポーネントを使用

MDX構文の代わりに、直接コンポーネントを使用することもできます。

```tsx
import { CodeBlock } from "@/components/code-block";

const codes = [
  {
    lang: "tsx",
    code: "const App = () => <div>Hello</div>",
    html: "<pre>...</pre>",
    title: "app.tsx",
  },
  {
    lang: "css",
    code: ".btn { color: blue; }",
    html: "<pre>...</pre>",
    title: "styles.css",
  },
];

export default function Example() {
  return <CodeBlock codes={codes} />;
}
```

### カスタムコピーボタン

コピーボタンをカスタマイズする場合：

```tsx
import { CodeCopyButton } from "@/components/code-block";

// CodeCopyButtonコンポーネントは自動的にコンテキストから
// 現在のコードを取得します
<CodeCopyButton />
```

## 技術詳細

- **Radix UI Tabs** - タブ機能の実装
- **Shiki** - シンタックスハイライトのサポート
- **LocalStorage** - グループ選択の永続化
- **React Context** - 状態管理

## インストール

<RegistryInstallCommand registryName="code-block" />

## 注意事項

- `CodeGroupProvider` は、グループ機能を使用する場合に必須です
- シンタックスハイライトのHTMLは、ビルド時に生成される必要があります
- Shikiトランスフォーマーの注釈（`// [!code ...]`）は、コピー時に自動的に削除されます
